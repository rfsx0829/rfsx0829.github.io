---
title: 一个图片迁移工具
tags:
  - Tools
date: 2019-07-20 17:31:51
categories: Tools
abbrlink: 720
---
# 一个图片迁移工具

很久没写博客。可能是忘记了吧。

听到朋友问，为啥博客很多图片都看不到了，于是打开看看，确实出现了一些问题，原来用的简书的图床出了些问题，偶尔可以用偶尔又出问题，让人很是头疼。

于是我自己写了个图片迁移工具，把博客的 md 文件里，原来简书图床的图片批量下载，然后上传到自己的图床上或者是其他比较优秀的图床，比如语雀或者 GitHub 之类的，但是看了看语雀的 API 文档，目前的文件上传接口还没有完全开放，还需要自己去申请，考虑到 GitHub 或许在国内条件又不是很好，于是就决定上传到自己服务器上

正好也很久没写博客，现在做出了工具，正好可以写个博客来记录一下。

但其实很多详细的东西直接可以去看代码和 README 就可以了，在博客里我最多也就瞎扯扯。

工具具体呢，可以处理单 md 文件，也可以处理一个文件夹里所有的 .md 文件。

具体做的事情是

1. 找出所有的图片链接，用的是正则表达式，目前只检测 png 和 jpg 两类图片
2. 从所有的链接中找出要替换的图床里的图片链接，因为不是所有的图片都是需要替换的，只有坏图床里的图片需要替换到好图床里，于是需要自己指定 专门挑出 哪个图床的链接。如果上传失败会将图片写入到本地。
3. 挑出链接后，遍历，下载并重新上传，获得新的图片地址，暂时存在内存中
4. 一个文件中所有符合条件的图片都下载并上传完成后，进行链接的文本替换
5. 替换链接完成后，写入到 xxx_new.md 文件，原文件不影响

基础功能很简单，但确实简化了我不少的工作。
